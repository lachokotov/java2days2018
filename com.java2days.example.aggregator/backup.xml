<?xml version="1.0" encoding="UTF-8"?>

<!-- National rail LDBWS. Downloads from departure board web servise. -->

<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
             http://www.osgi.org/xmlns/blueprint/v1.0.0 https://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
             http://camel.apache.org/schema/blueprint http://camel.apache.org/schema/blueprint/camel-blueprint.xsd">

	<bean id="aggregateStrategy"
		class="com.java2days.example.aggregator.StringAggregationStrategy" />
	<camelContext
		xmlns="http://camel.apache.org/schema/blueprint" trace="true">

		<route id="aggregate" trace="true">
			<from id="direct"
				uri="file:/tmp/Java2Days/aggregate/inbox/" />
			<when>
				<simple>${header.CamelFileName} starts with 'A' || ${header.CamelFileName} starts with 'B'</simple>
				<setHeader headerName="AggregatoinId">
					<constant>1</constant>
				</setHeader>
				<log message="######### Body is ${header.CamelFileName}" />
			</when>
			<when>
				<simple>${header.CamelFileName} starts with 'C' || ${header.CamelFileName} starts with 'D'</simple>
				<setHeader headerName="AggregatoinId">
					<constant>2</constant>
				</setHeader>
				<log message="********* Body is ${body}" />
			</when>
			<convertBodyTo type="java.lang.String" />
			<aggregate id="Aggregate Short term and Reference data"
				strategyRef="aggregateStrategy" completionSize="2">
				<correlationExpression>
					<header>AggregatoinId</header>
				</correlationExpression>
				<when>
				<simple>${header.AggregatoinId} == 1</simple>
				<setHeader headerName="CamelFileName">
					<constant>Aggregated_AB.txt</constant>
				</setHeader>
				</when>
				<when>
				<simple>${header.AggregatoinId} == 2</simple>
				<setHeader headerName="CamelFileName">
					<constant>Aggregated_CD.txt</constant>
				</setHeader>
				</when>
				<to id="to outbox"
					uri="file:/tmp/Java2Days/aggregate/outbox" />
			</aggregate>
		</route>
	</camelContext>
</blueprint>
